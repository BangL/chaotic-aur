#!/bin/bash
cd /tmp

BUILDDIR="hourly.$(date '+%Y%m%d%H%M%S')"
mkdir -p "$BUILDDIR" || exit
cd "$BUILDDIR" || exit

repoctl down -u
rm -rf llvm-svn ffmpeg-full
repoctl list |\
       	grep '\-\(git\|svn\|bzr\|nightly\)$' |\
       	sort | comm -13 ~/ignore-hourly.txt - |\
	xargs repoctl down
ls | xargs echo '[build-hourly] Building: '
~/chaotic-batchbuild

mkdir -p /tmp/hourly-log
mv ./*.log /tmp/hourly-log/

cd ..
rm -rf "$BUILDDIR"

~/chaotic-add
~/chaotic-status > /srv/http/chaotic-aur/analytics.txt
