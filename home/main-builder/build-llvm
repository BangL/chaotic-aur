#!/usr/bin/env bash
LOGDIR='/srv/http/chaotic-aur/makepkglogs/_daily'
cd /tmp

single_build() {
	echo "[build-llvm] Target: $1"

	echo '[build-llvm] Downloading'
	repoctl down "$1" || return
	
	echo '[build-llvm] Building'
	cd "$1"
	~/chaotic-makepkg --sign -sc --nocheck --noconfirm \
		2>&1 | tee "$LOGDIR/$1" && \
		~/chaotic-add
	cd ..
	
	echo '[build-llvm] Nuking'
	sudo rm -rf "/tmp/$1"
}


for _PKG_PRE in {'','lone_wolf-'}{'','lib32-'}; do
	for _PKG_POS in {'','-libs'}'-git'; do
		single_build "${_PKG_PRE}llvm${_PKG_POS}"
	done
done
single_build 'lone_wolf-compiler-rt-git'
single_build 'lone_wolf-clang-git'
