#!/usr/bin/env bash
LOGDIR='/srv/http/chaotic-aur/makepkglogs/_daily'
mkdir -p '/tmp/daily.llvm'

single_build() {
	cd '/tmp/daily.llvm'
	echo "[build-llvm] Target: $1"

	echo '[build-llvm] Downloading'
	repoctl down "$1" || return
	
	echo '[build-llvm] Building'
	cd "$1"
	~/chaotic-makepkg -c --nocheck --noconfirm \
		2>&1 | tee "$LOGDIR/${1}.log" && \
		~/chaotic-add
	
	echo '[build-llvm] Nuking'
	cd '/tmp/daily.llvm'
	rm -rf "$1"
}


for _PKG_PRE in '' 'lib32-'; do
	for _PKG_POS in {,'-libs'}{,'-minimal'}'-git'; do
		single_build "${_PKG_PRE}llvm${_PKG_POS}"
	done
done
single_build 'compiler-rt-minimal-git'
single_build 'clang-minimal-git'
